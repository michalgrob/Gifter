

<!--<div style=" background-color: #fafafa; height: 300px ; width: 100%; position: absolute; z-index: -10;"></div>-->
<% layout('boilerplate') %>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


<style>

    .card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        width: 40%;
        border-radius: 5px;
    }

    .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }

    img {
        border-radius: 5px 5px 0 0;
    }

    .container {
        /*padding: 2px 16px;*/
    }
    .container1 {
        border: 2px solid #ccc;
        background-color: #eee;
        border-radius: 5px;
        padding: 16px;
        margin: 16px 0
    }

    .container::after {
        content: "";
        clear: both;
        display: table;
    }

    .container img {
        float: left;
        margin-right: 20px;
        border-radius: 50%;
    }

    .container span {
        font-size: 20px;
        margin-right: 15px;
    }

    @media (max-width: 500px) {
        .container {
            text-align: center;
        }
        .container img {
            margin: auto;
            float: none;
            display: block;
        }
    }
</style>
<!--<div class="container">-->
<div style="color: #067c8d;"class="jumbotron">
    <div class="text-center">
        <h1>Create Event</h1>
        <h4>Create your own event<br> And invite your best</h4>
    </div>
</div>
<!---->
<!---->
<div id="resultC" style="display:none; color: #067c8d " >
    <div class="text-center">
        <h4>Event created successfully</h4>
    </div>
</div>
<!-- < style="margin-top:81px;">
     <!--<div style="background-color:#2e2e2e; height:9%">-->
<div class="container">
    <form name="Form"  class=center-block">
        <!--method="post" action="/wishlist/addEvent"-->
        <div class="" >
            <div id="eventDetails"  class="Info">
                <!---->
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <label class="formInputLbl">Title: </label>
                    </div>
                    <div class="col-md-7">
                        <input class="textDesc form-control"type="text" name="eventTitle" id="eventTitle" value=""required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <label class="formInputLbl">Description: </label>
                    </div>
                    <div class="col-md-7">
                        <input class="textDesc form-control" type="text" name="eventDescription" id="eventDescription"required >
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <label class="formInputLbl">Date:</label>
                    </div>
                    <div class="col-md-7">
                        <input class="form-control textDesc8"type="datetime-local" name="eventDate" id="eventDate" value="2017-09-04" style="width: 60%"required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-2">
                        <label class="formInputLbl">Guests: </label>
                    </div>
                    <div class="col-md-7">
                        <input class="textDesc form-control"type="text" name="eventGuests" id="eventGuests" value="">

                        <!--<div class="col-md-1">-->
                        <span id='add' type='button' onclick="ajaxCheckIfGuestIsRegister()">
                            <!--<input type='button' id='add'onclick="ajaxCheckIfGuestIsRegister()" >-->
                            <i class="fa fa-user-plus" aria-hidden="true"></i>
                                </span>
                        <!--</div>-->

                    </div>

                </div>


                <ul id='list' name="guestsList" style="text-align: center"></ul>
            </div>

        </div>
        <div class="row" style="align: center;">
            <div class="col-md-4 "></div>
            <div class="col-md-2 ">
                <input id="myBtn" class="giftsbtn btn btn-primary btn-xl page-scroll center-block" type="button" value = 'show gifts' name="submit" onclick="ajaxGiftToAdd()" >
            </div>



            <div class="col-md-2 ">
                <input onclick="ajaxSaveChanges()" class="giftsbtn btn btn-primary btn-xl page-scroll center-block" type="submit"style="text-align: center" value = 'Save Event' name="submit" style="margin-right: 5%">

            </div>
            <div class="col-md-4 "></div>
        </div>

        <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <p>Create your Wishlist</p>

                <section id="giftsResultSection" style="display:none">

                    <div class="row">

                        <div class="no-padding " id="portfolio">
                            <!--<label>Sort By: </label>-->
                            <!--<select id="sort" onchange="sortResult(this)">&ndash;&gt;-->
                            <!--<option value="">Choose:</option>-->
                            <!--<option value="sortByResult">best results</option>-->
                            <!--<option value="sortByPrice">price</option>-->
                            <!--<option value="sortByStore">store</option>-->
                            <!--</select>-->

                            <!--<div class="container-fluid">-->
                            <div id="gifts-list" class="gift-list "
                                 class="row no-gutter popup-gallery col-sm-1 col-md-1 col-md-offset-1">

                            </div>
                        </div>
                    </div>

                </section>
            </div>

        </div >
        <div  class="col-md-10 center-block" >
            <h1 style="margin-left:auto">Your Wishlist</h1>

            <div class="row">

                <div class="row no-gutter popup-gallery col-md-2 col-md-offset-4 my-gift-list">

                    <!--class="col-sm-6 col-md-6 col-md-offset-3 col-sm-offset-3"-->
                    <ul id="list-group" name="chosenGifts" class="list-group "style="width:85%;">

                    </ul>
                </div>
            </div>
        </div>
    </form>


    <!-- The Modal -->
    <div id='myModalErrorGuest' class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span id="errMail"></span>
            <span id="errMsg"></span>
            <button onclick='ajaxInviteNotRegistered()'>invite this email addres to GIFTER</button>
        </div>
    </div>

</div>


<script type="text/javascript">
    function ValidationAppForm() {
        var title=document.Form.eventTitle
        var description=document.Form.eventDescription;
        var date=document.Form.eventDate;
        var guestList = Array.from(document.querySelectorAll('#list>li'));

        if (title.value=="")
        {
//
            document.Form.eventTitle.focus() ;
            return false;
        }
        if (description.value=="")
        {
            document.Form.eventDescription.focus() ;
            return false;
        }
        if (guestList.length==0)
        {
            document.Form.eventGuests.focus() ;
            return false;
        }

        return true;


    }
    function ajaxSaveChanges() {
        if (ValidationAppForm()) {
            var guestArrayData = [];
            var unRegMails=[];
            var guestList = Array.from(document.querySelectorAll('#list>li'));

            for (var i = 0; i < guestList.length; i++) {
                if (guestList[i].getAttribute("id") != "") {
                    guestArrayData.push({
                        email: guestList[i].textContent,
                        id: guestList[i].getAttribute("id"),
                        username: guestList[i].getAttribute("name")
                    });
                }
                else
                {
                    unRegMails.push(guestList[i].textContent);
                }
            }

            var gifts = [];
            var giftsList = Array.from(document.querySelectorAll('#list-group>div'));
            console.log(giftsList);

            for (var j = 0; j < giftsList.length; j++) {
                gifts.push({id: giftsList[j].getAttribute("id")});
            }

            var eventTitle = document.getElementById("eventTitle").value;
            var eventDescription = document.getElementById("eventDescription").value;
            var eventDate = document.getElementById("eventDate").value;


            $.ajax({
                type: "POST",
                dataType: "json",
                data: {
                    unRegMails:JSON.stringify(unRegMails),
                    guests: JSON.stringify(guestArrayData),
                    gifts: JSON.stringify(gifts),
                    eventTitle: eventTitle,
                    eventDescription: eventDescription,
                    eventDate: eventDate
                },
                url: "/wishlist/addEvent",
                success: function (msg) {
                    document.getElementById('resultC').style.display='none';
                }
            });
        }
    }

    function ajaxGiftToAdd() {
        $.ajax({
            type: "POST",
            url: "/searchingResult/giftSearchByClient",
            success: function (data,status) {
                console.log(data);
                displayGifts(data);
            }
        })
    }

    var modal;
    var span = document.getElementsByClassName("close")[0];


    function displayGifts(gifts) {
        // var giftsArr = gifts.toArray();
        for(var i=0; i<gifts.length; i++){
            var newDiv = document.createElement("div");
            newDiv.setAttribute("style","background-color:white;height:250px;align-items:center;width:250px");
            newDiv.setAttribute("class","w3-card-2 col-sm-1");
            newDiv.setAttribute("data-storeId",gifts[i].store_id);
            newDiv.setAttribute("data-price",gifts[i].price);//
            newDiv.setAttribute("data-totalScore",gifts[i].tot);
            newDiv.setAttribute("name",gifts[i].name);
            newDiv.setAttribute("id",gifts[i].id);

            var newImg = document.createElement("img");
            newImg.setAttribute("style","margin:0;height:70px;");//
            newImg.setAttribute("src",gifts[i].ImageUrl);
            newImg.setAttribute("class","img-responsive");

            var newP = document.createElement("p");
            newP.setAttribute("id",gifts[i].name);
            newP.setAttribute("name","gift");
            newP.setAttribute("style","width:70%;margin-left:15%; color: #0b0b0b");
            var nexContent = document.createTextNode(gifts[i].name +"\n"+gifts[i].price+" NIS"+"\n"+gifts[i].storeName);

            var newButton = document.createElement("button");
            newButton.setAttribute("type","button");
            newButton.setAttribute("id","b"+gifts[i].name);
            newButton.onclick = function(){addGiftToWishlist(this.id)};
            //newButton.addEventListener('click',function(){addGiftToWishlist(gifts[i].name);});
            newButton.setAttribute("style","background-color: white;color:#067c8d;width:30px; height: 30px; ");

            var newI = document.createElement("i");
            newI.setAttribute("class","fa fa-shopping-bag");
            newI.setAttribute("aria-hidden","true");
            newI.setAttribute("data-sr-id","5");
            newI.setAttribute("style","font-size:30px;margin-left:-15px;");
            newI.setAttribute("id","ib"+gifts[i].name);

            newButton.appendChild(newI);

            newP.appendChild(nexContent);
            newDiv.appendChild(newP);
            newDiv.appendChild(newImg);
            newDiv.appendChild(newButton);
            document.getElementById("gifts-list").appendChild(newDiv);

        }

        var giftsSection = document.getElementById("giftsResultSection");
        giftsSection.style.display = 'block';

        modal = document.getElementById('myModal');
        modal.style.display = "block";

    }
    function checkIfAlreadyChoose(guestMail) {
        var guestList = Array.from(document.querySelectorAll('#list>li'));

        for (var i = 0; i < guestList.length; i++) {
            console.log(guestList[i].innerText);
            if(guestList[i].innerText==guestMail)
            {
                return true;
            }
        }
        return false;

    }
    function ajaxCheckIfGuestIsRegister() {
        var guestMail = document.getElementById("eventGuests").value;
        guestMail=guestMail.toLowerCase();
        if (checkIfAlreadyChoose(guestMail)==true) {
            alert(guestMail + " already invited to your event");
        }
        else {

            $.ajax({
                type: "GET",
                url: "/wishlist/checkIfGuestIsRegister/" + guestMail,
                success: function (user) {
                    if (user!= "0")
                    {
                        addGuests(user.id,user.username,guestMail);
                        console.log(user.id);
                    }
                    else {
                        if (checkIfAlreadyChoose(guestMail)==true) {
                            alert(guestMail + " already invited to your event");
                        }
                        else{
                            var ans = confirm(guestMail + " isn't register.\n would you like to invite him/her anyway?");
                            if (ans == true) {
                                ajaxInviteNotRegistered(guestMail);
                                //  txt = "You pressed OK!";
                            } else {
                                // txt = "You pressed Cancel!";
                            }
                            // document.getElementById("errMail").innerHTML = guestMail ;
                            // modal = document.getElementById('myModalErrorGuest');
                            // modal.style.display = "block";
                        }
                    }
                }



            });
        }
    }
    function removeFromGuestList(elementToRemove) {
        var x=90;
        var nameToRemove=elementToRemove.getAttribute("name");
        var splitIconName=nameToRemove.split(";");
        var elementName= splitIconName[1];
//        var guestList = Array.from(document.querySelectorAll('#list>li'));
        document.getElementsByName(elementName)[0].style.display='none';
        document.getElementsByName(elementName)[0].remove();
//        var guestList = Array.from(document.querySelectorAll('#list>li'));
//
//        for (var i = 0; i < guestList.length; i++) {
//            if (guestList[i].getAttribute("name") ==nameToRemove) {
//                document.getElementsByName(name).parentElement.style.display='none';
//
//            }
//        }
//

    }
    function addGuests(id,username,userEmail) {//validation mail!!todo
        <!--<i class="fa fa-trash" aria-hidden="true">-->


        var span=document.createElement("span");
        span.setAttribute("class",'w3-button w3-white w3-xlarge');
        var removeIcon=document.createElement("i");
        removeIcon.setAttribute("class",'fa fa-user-times');
        removeIcon.setAttribute("onclick",'removeFromGuestList(this)');
        removeIcon.setAttribute("name","icon;"+userEmail);
        removeIcon.setAttribute("aria-hidden","true");
        var node = document.createElement("Li");
        node.setAttribute("id",id.toString());
        node.setAttribute("name",userEmail);
//        node.setAttribute("class",userEmail);
        node.setAttribute("style","display:block");
        var text = document.getElementById("eventGuests").value.toLowerCase(); //.value gets input values
        var textnode = document.createTextNode(text);
        node.appendChild(textnode);

        span.appendChild(removeIcon);
        node.appendChild(span);

        document.getElementById("list").appendChild(node);
        document.getElementById("eventGuests").value="";
    }

    function addGiftToWishlist(giftName) {

        var gifts = $("#gifts-list > div");
        var rightList =  document.getElementById("list-group");

        for (var i = 0; i < gifts.length; i++) {

            var elm='b'+gifts[i].getAttribute("name");
            if( elm == giftName){
                rightList.appendChild(gifts[i]);
                document.getElementById(giftName).onclick = function(){removeGiftfromWishlist(giftName)};
                document.getElementById('i'+giftName).setAttribute("class","fa fa-times");//fa fa-shopping-bag
            }

        }


    }

    function removeGiftfromWishlist(giftName) {

        var gifts = $("#list-group > div");
        var rightList =  document.getElementById("gifts-list");

        for (var i = 0; i < gifts.length; i++) {

            var elm='b'+gifts[i].getAttribute("name");
            if( elm == giftName){
                rightList.appendChild(gifts[i]);
                document.getElementById(giftName).onclick = function(){addGiftToWishlist(giftName)};
                document.getElementById('i'+giftName).setAttribute("class","fa fa-shopping-bag");//

            }

        }
    }

    // Get the modal

    // }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    function ajaxInviteNotRegistered(guestEmail) {
        //var guestEmail = document.getElementById("errMail").innerHTML;

        addGuests("",guestEmail,guestEmail);
        var eventTitle = document.getElementById("eventTitle").value;
        var eventDescription = document.getElementById("eventDescription").value;
        var eventDate = document.getElementById("eventDate").value;

        $.ajax({
            type: "POST",
            dataType: "json",
            data: {
                guestEmail: guestEmail,
                eventTitle: eventTitle,
                eventDescription: eventDescription,
                eventDate: eventDate
            },
            url: "/wishlist/inviteToGifter",
            success: function (msg) {
                document.getElementById('resultC').style.display='none';
            }
        });

    }

</script>

