<% layout('boilerplate') %>

<div class="container">
    <div class="row">

        <p></p>
        <h1>Mall Stores</h1>
        <p>A list of all the stores inside the mall.</p>
        <p> </p><p> </p>

        <div class="col-md-10 col-md-offset-1">

            <div class="panel panel-default panel-table">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col col-xs-6">
                            <h3 class="panel-title">Store List</h3>
                        </div>
                        <div class="col col-xs-6 text-right">
                            <button type="button" onclick="toggleCreateNewStorePopupVisibility(true)" class="btn btn-sm btn-primary btn-create">Create A New Store</button>
                        </div>
                        <div class="col col-xs-6 text-right">
                            <form method="get" action="/mallManager">
                                <button type="submit" class="btn btn-sm btn-primary btn-create"><i class="fa fa-refresh" aria-hidden="true"></i> Refresh</button>
                            </form>
                        </div>
                        <div class="col col-xs-6 text-right">
                            <form method="post" action="/mallManager/importCSV" enctype="multipart/form-data">
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <input type="file" id="fileInput" style="display:none;" onchange="this.form.submit()" name="csv_file" />
                                    <button type="button" class="btn btn-default btn-file" data-provides="fileinput" onclick="document.getElementById('fileInput').click();"><i class="fa fa-upload" aria-hidden="true"></i>Import Stores From CSV</button>
                                </div>
                            </form>
                        </div>
                    </div>
<!--
                    <input type="text" id="searchInput" onkeyup="searchStores()" placeholder="Search for stores..." title="Type in a name" >
-->
                </div>
                <div class="panel-body">
                    <table id="stores_table" class="table table-striped table-bordered" style="table-layout:fixed">
                        <thead>
                        <tr>
                            <th><em class="fa fa-cog" align="center"></em></th>
                            <th class="hidden-xs">Store ID</th>
                            <th>Store Name</th>
                            <th>Store Location</th>
                        </tr>
                        </thead>
                        <tbody id="stores_table_body">
                        <!--                        <tr>
                                                    <td align="center">
                                                        <a class="btn btn-default"><em class="fa fa-pencil"></em></a>
                                                        <a class="btn btn-danger"><em class="fa fa-trash"></em></a>
                                                    </td>
                                                    <td class="hidden-xs">1</td>
                                                    <td>John Doe</td>
                                                    <td>johndoe@example.com</td>
                                                </tr>-->
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>


<script>

    window.onload = loadStores();

    function  loadStores() {
        var table = '';
        var av_stores = <%- JSON.stringify(available_stores) %>;
        var rowsNumber = av_stores.length;
        for(var r = 0; r < rowsNumber; r++)
        {
            table+= '<tr id="row-' + r + '">';

            table+= '<td align="center">';
            table+= '<button id="edit_button" type="button" onclick="editStore(' + r + ')" class="btn btn-default"><em class="fa fa-pencil"></em></button>';
            table+= '<button id="delete_button" type="button" onclick="deleteStore(' + r + ')" class="btn btn-danger"><em class="fa fa-trash"></em></button>';
            table+= '</td>';
            table+= '<td class="hidden-xs" id="store_id_field">' + av_stores[r].store_id + '</td>';
            table+= '<td id="store_name_field">' + av_stores[r].name + '</td>';
            table+= '<td id="store_location_field">' + av_stores[r].location + '</td>';

            table+= '</tr>';
        }
        var tbody = document.getElementById("stores_table_body");
        tbody.innerHTML = table;
    }
</script>

<script type="text/javascript" >
    function deleteStore(rowNum)
    {
        var rowElement = document.getElementById("row-" + rowNum);
        var storeName = rowElement.getElementsByTagName("td")[2].textContent;

        var isDeletionConfirmed = showDeleteConfirmationDialog(storeName);
        if(isDeletionConfirmed){
            post('/mallManager/deleteStore', {store_name: storeName});
        }
    }
</script>

<script type="text/javascript" >
    function showDeleteConfirmationDialog(storeName){
        var x = confirm("Are you sure you want to delete the store: " + storeName + "?");
        if (x)
            return true;
        else
            return false;
    }
</script>

<script type="text/javascript" >
    function editStore(rowNum)
    {
        var rowElement = document.getElementById("row-" + rowNum);
        var storeName = rowElement.getElementsByTagName("td")[2].textContent;
        alert("editStore  store: " + storeName + " number: " + rowNum + "!");
    }
</script>

<script type="text/javascript" >
    function post(path, params, method) {
        method = method || "post"; // Set method to post by default if not specified.

// The rest of this code assumes you are not using a library.
// It can be made less wordy if you use one.
        var form = document.createElement("form");
        form.setAttribute("method", method);
        form.setAttribute("action", path);

        for(var key in params) {
            if(params.hasOwnProperty(key)) {
                var hiddenField = document.createElement("input");
                hiddenField.setAttribute("type", "hidden");
                hiddenField.setAttribute("name", key);
                hiddenField.setAttribute("value", params[key]);

                form.appendChild(hiddenField);
            }
        }

        document.body.appendChild(form);
        form.submit();
    }
</script>

<script type="text/javascript">
    $(document).ready(function() {
        $('#stores_table').DataTable();
    } );
</script>

<!--<script type="text/javascript">
    function searchStores() {
        var input, filter, storesTableBodyElement, trs, tdStoreName, i,table;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        storesTableBodyElement = document.getElementById("stores_table_body");
        table = document.getElementById("stores_table");
        trs = storesTableBodyElement.getElementsByTagName("tr");
        for (i = 0; i < trs.length; i++) {
            tdStoreName = trs[i].getElementsByTagName("td")[2].textContent;
            console.log(tdStoreName);
            if (tdStoreName.toUpperCase().indexOf(filter) > -1) {
                trs[i].style.display = "";
            } else {
                trs[i].style.display = "none";
            }
        }
    }
</script>-->






<!--------------------------------------------------------Create New Store Popup--------------------------------------------------------------->

<div id="popup_create_new_store" class="modal">
    <div class="modal-content animate" >
        <div class="imgcontainer">
            <span onclick="toggleCreateNewStorePopupVisibility(false)" class="close" title="Close Popup">&times;</span>
            <img class="img-circle" src="img/gifter.jpg" alt="Create New Store" class="avatar">
        </div>
        <form name="singnupForm" class="form-horizontal" method="post" action="/mallManager/createNewStore" >
            <!--onsubmit="return validationUserInput()"-->

            <div class="form-group">
                <label for="name" class="cols-sm-2 control-label" >Store Name</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span>
                        <input type="text" class="form-control" name="store_name" id="store_name"  placeholder="Enter your Name"required/>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="email" class="cols-sm-2 control-label">Store Email</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-envelope fa" aria-hidden="true"></i></span>
                        <input type="text" class="form-control" name="store_manager_email" id="store_manager_email"  placeholder="Enter your Email"required/>
                    </div>
                </div>
            </div>


            <div class="form-group">
                <label for="username" class="cols-sm-2 control-label">store Username</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-users fa" aria-hidden="true"></i></span>
                        <input type="text" class="form-control" name="store_manager_username" id="store_manager_username"  placeholder="Enter store Username"required/>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="password" class="cols-sm-2 control-label">Password</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
                        <input type="password" class="form-control" name="store_manager_password" id="store_manager_password"  placeholder="Enter your Password"required/>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="confirm" class="cols-sm-2 control-label">Confirm Password</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
                        <input type="password" class="form-control" name="confirm" id="confirm"  placeholder="Confirm your Password"required/>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="username" class="cols-sm-2 control-label">Store Id</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-users fa" aria-hidden="true"></i></span>
                        <input type="text" class="form-control" name="store_id" id="store_id"  placeholder="Enter store id as given grom Manager"required/>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="username" class="cols-sm-2 control-label">Store Location</label>
                <div class="cols-sm-10">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="fa fa-location-arrow" aria-hidden="true"></i></span>
                        <input type="text" class="form-control" name="store_location" id="store_location"  placeholder="Enter store location inside the mall"required/>
                    </div>
                </div>
            </div>
            <div class="form-group ">
                <button type="submit" onclick="toggleCreateNewStorePopupVisibility(false);" class="btn btn-primary btn-lg btn-block login-button" >Add New Store</button>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleCreateNewStorePopupVisibility(isToShowPopup) {
        var popupCreateNewStore = document.getElementById('popup_create_new_store');
        if(isToShowPopup){
            popupCreateNewStore.style.display = "block";
        }else{
            popupCreateNewStore.style.display = "none";
        }
    }

    window.onclick = function(event) {
        if (event.target == document.getElementById('popup_create_new_store')) {
            toggleCreateNewStorePopupVisibility(false);
        }
    }
</script>
